  <%# ------------------------ Header --------------------------------------- %>

<div class="mb-3 p-4" style="background-color: #a8d254; opacity: 0.5; display: flex; justify-content: center; align-items: center; position: relative;">
  <%= link_to request.referer, style: "position: absolute; left: 20px;" do %>
    <i class="fa-regular fa-circle-left fa-2xl" style="color: #000000;"></i>
  <% end %>
  <h1 class="text-center" style="margin: 0;">COMMENT / SHARE</h1>
</div>

  <%# -------------------- Recipe details------------------------------------ %>

<div class="border mx-3 p-3 mb-3">
  <h3><strong><%= @recipe.title %></strong></h3>
  <p>Prep-time : <%= @recipe.prep_time %></p>
  <p>Servings : <%= @recipe.servings %></p>
</div>


<div data-controller="insert-in-list">
  <div class="border mx-3 p-3">
    <p>Your last rating : <%= @recipe.rating %> / 5</p>
    <p>Your comments :</p>
    <% if @comments.any? %>
      <ul>
        <% @comments.each do |comment| %>
          <li>
            <strong><%= comment.created_at.strftime("%d %b %Y, %H:%M") %></strong> :
            <%= comment.content %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No comment for this recipe.</p>
    <% end %>
  </div>



  <div class="d-flex justify-content-between">
    <%# ---------------------- Rate ------------------------------------------- %>
    <div class="m-3">
      <h4>Rate This Recipe</h4>
      <%= render "form_rating", recipe: @recipe %>
    </div>

  <%# --------------------------- Comment ----------------------------------- %>
    <div data-controller="toggle" class="m-3">
      <button data-action="click->toggle#fire" class="border-0 bg-transparent">
        <i class="fa-regular fa-message fs-1" style="cursor: pointer;"></i>
      </button>

      <div data-toggle-target="togglableElement" class="d-none">
        <%= render "form", comment: @comment, recipe: @recipe %>
      </div>
    </div>

    <%# ----------------------- Share ----------------------------------------- %>

    <div class="mt-3 me-3">
        <button id="share-button" class="border-0 bg-transparent" data-url="<%= recipe_url(@comment.recipe) %>">
          <i class="fa-solid fa-share-nodes fs-1"></i>
        </button>
      </div>

  </div>
</div>

  <%# --------------- Back to home page --------------- %>
<div class="d-flex justify-content-center">
    <%= link_to "Back to home page", erase_path, class: "btn btn-dark rounded-pill mx-5" %>
</div>


  <%# -------------------- Script ------------------ %>

<script>
  const button = document.getElementById("share-button")
  button.addEventListener("click", function () {
    const message = `"Check out this recipe I just tried!" ${button.dataset.url}`;
    const whatsappURL = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, "_blank");
  });
</script>
